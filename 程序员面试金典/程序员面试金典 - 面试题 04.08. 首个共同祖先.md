> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode-cn.com/problems/first-common-ancestor-lcci/)

> ä»Šå¤©ç»§ç»­æ›´æ–°ç¨‹åºå‘˜é¢è¯•é‡‘å…¸ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ **é¢è¯•é‡‘å…¸** å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

è®¾è®¡å¹¶å®ç°ä¸€ä¸ªç®—æ³•ï¼Œæ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸¤ä¸ªèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå…±åŒç¥–å…ˆã€‚ä¸å¾—å°†å…¶ä»–çš„èŠ‚ç‚¹å­˜å‚¨åœ¨å¦å¤–çš„æ•°æ®ç»“æ„ä¸­ã€‚æ³¨æ„ï¼šè¿™ä¸ä¸€å®šæ˜¯äºŒå‰æœç´¢æ ‘ã€‚

ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘: root = [3,5,1,6,2,0,8,null,null,7,4]

```
    3
   / \
  5   1
 / \ / \
6  2 0  8
  / \
 7   4
```

### ç¤ºä¾‹ 1:

- è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1
- è¾“å‡º: 3
- è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚

### ç¤ºä¾‹ 2:

- è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4
- è¾“å‡º: 5
- è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚

### è¯´æ˜:

- æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚
- pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚

## é¢˜ç›®æ€è€ƒ

1. å¦‚æœé™åˆ¶åªèƒ½ç”¨é€’å½’æˆ–è€…è¿­ä»£, å¦‚ä½•è§£å†³?

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1

#### æ€è·¯

- é¦–å…ˆå°è¯•é€’å½’çš„åšæ³•, å¦‚æœæˆ‘ä»¬èƒ½å¾—å‡ºå·¦å³å­æ ‘å„è‡ªçš„ p/q èŠ‚ç‚¹å­˜åœ¨çš„æƒ…å†µ, å†ç»“åˆå½“å‰èŠ‚ç‚¹, å°±èƒ½å¾—å‡ºå½“å‰èŠ‚ç‚¹ä»¥åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¸­æ˜¯å¦åŒ…å« p å’Œ q
- é‚£ä¹ˆåœ¨**ç¬¬ä¸€æ¬¡**æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªè‡ªèº«æˆ–å­èŠ‚ç‚¹ä¸­åŒæ—¶åŒ…å« p å’Œ q çš„èŠ‚ç‚¹æ—¶, è¿™ä¸ªèŠ‚ç‚¹å°±ä¸€å®šæ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ, å› ä¸ºå…¶æ‰€æœ‰å­èŠ‚ç‚¹éƒ½ä¸æ»¡è¶³è¿™ä¸€æ€§è´¨, ä¸å¯èƒ½æœ‰æ›´è¿‘çš„ç¥–å…ˆäº†
- æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•å®ç°:
  1. **é¦–å…ˆå®šä¹‰å¾…æ±‚çš„ç¥–å…ˆèŠ‚ç‚¹:** åˆå§‹åŒ–ä¸ºç©º, è¡¨ç¤ºè¿˜æœªæ‰¾åˆ°
  2. **æ¥ä¸‹æ¥å®šä¹‰é€’å½’æ–¹æ³•:** æ ¹æ®ä¸Šé¢çš„åˆ†æ, é€’å½’æ–¹æ³•ä¸­éœ€è¦ä¼ å…¥å½“å‰èŠ‚ç‚¹, å¹¶è¿”å›ä¸¤ä¸ª bool, åˆ†åˆ«ä»£è¡¨å½“å‰èŠ‚ç‚¹ä»¥åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¸­æ˜¯å¦åŒ…å« p æˆ– q
  3. **ç¬¬ä¸‰æ­¥å®šä¹‰é€’å½’å‡ºå£:** å¾ˆæ˜¾ç„¶æ˜¯èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…ç¥–å…ˆèŠ‚ç‚¹å·²ç»æ‰¾åˆ°çš„æƒ…å†µ, æ­¤æ—¶ç›´æ¥è¿”å›
  4. **æœ€åè®¾è®¡æ­£å¸¸æƒ…å†µä¸‹çš„é€’å½’é€»è¾‘:** æˆ‘ä»¬ä¾æ¬¡é€’å½’è°ƒç”¨å·¦å³å­èŠ‚ç‚¹å¹¶å¾—åˆ°å®ƒä»¬ p/q èŠ‚ç‚¹å­˜åœ¨çš„æƒ…å†µ, å¹¶è€ƒè™‘å½“å‰èŠ‚ç‚¹æœ¬èº«æ˜¯å¦ä¸º p/q, ä»è€Œå¾—åˆ°å½“å‰çš„ä¸¤ä¸ª bool è¿”å›å€¼. å¦‚æœå®ƒä»¬éƒ½æ˜¯ true**ä¸”å½“å‰ç¥–å…ˆä¸ºç©º**çš„è¯, å°±æŠŠç¥–å…ˆè®¾ä¸ºå½“å‰èŠ‚ç‚¹, å³æ‰¾åˆ°äº†æœ€è¿‘ç¥–å…ˆ. (å› ä¸ºæœ€è¿‘ç¥–å…ˆçš„æ›´é«˜å±‚çš„çˆ¶èŠ‚ç‚¹çš„ä¸¤ä¸ª bool è‚¯å®šä¹Ÿæ˜¯ true, æ‰€ä»¥å¿…é¡»åˆ¤æ–­å½“å‰ç¥–å…ˆä¸ºç©ºæ‰èµ‹å€¼, ä¿è¯ç¥–å…ˆæ˜¯æœ€è¿‘çš„)
- ä¸‹é¢ä»£ç å¯¹å¿…è¦æ­¥éª¤æœ‰è¯¦ç»†è§£é‡Š, æ–¹ä¾¿å¤§å®¶å‚è€ƒ

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(N): æœ€å¤šéœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹ä¸€é
- ç©ºé—´å¤æ‚åº¦ O(H): é€’å½’æ ˆä¸­è¦å­˜æ ‘çš„é«˜åº¦ä¸ªèŠ‚ç‚¹

#### ä»£ç 

```python
class Solution:
    def lowestCommonAncestor(self, root: TreeNode, p: TreeNode,
                             q: TreeNode) -> TreeNode:
        # æ–¹æ³•1: é€’å½’dfs, è¿”å›æ˜¯å¦æ‰¾åˆ°pæˆ–q
        # æ³¨æ„ancestoråªèƒ½èµ‹å€¼ä¸€æ¬¡, å³ä¸ºæœ€è¿‘çš„ç¥–å…ˆ
        ancestor = None

        def find(cur):
            nonlocal ancestor
            if not cur or ancestor:
                # é€’å½’å‡ºå£, è¿”å›å…¨false
                return (False, False)
            # å…ˆå¾—å‡ºå·¦å³å­æ ‘ä¸Šçš„p/qèŠ‚ç‚¹å­˜åœ¨æƒ…å†µ
            lp, pq = find(cur.left)
            rp, rq = find(cur.right)
            # ç„¶åè®¡ç®—åŠ ä¸Šå½“å‰èŠ‚ç‚¹åçš„p/qèŠ‚ç‚¹å­˜åœ¨æƒ…å†µ
            findp = lp or rp or cur == p
            findq = pq or rq or cur == q
            # å¦‚æœä¸¤è€…éƒ½å­˜åœ¨, ä¸”ç¥–å…ˆè¿˜ä¸ºç©º, åˆ™è¡¨ç¤ºæ‰¾åˆ°æœ€è¿‘ç¥–å…ˆäº†, å³å½“å‰èŠ‚ç‚¹
            if findp and findq and not ancestor:
                ancestor = cur
            # è¿”å›å½“å‰èŠ‚ç‚¹ä»¥åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„p/qèŠ‚ç‚¹å­˜åœ¨æƒ…å†µ
            return (findp, findq)

        find(root)
        return ancestor
```

### æ–¹æ¡ˆ 2

#### æ€è·¯

- å‡å¦‚æ­¤æ—¶è¦æ±‚åªèƒ½åˆ©ç”¨è¿­ä»£æ¥å®ç°, åˆè¯¥å¦‚ä½•åšå‘¢?
- ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æ€è·¯æ˜¯æˆ‘ä»¬ä»ä¸¤ä¸ªèŠ‚ç‚¹å‡ºå‘, å¾€ä¸Šèµ°, å¹¶æŠŠè·¯ä¸Šçš„èŠ‚ç‚¹éƒ½åŠ å…¥é›†åˆä¸­
- ç„¶åæŸä¸ªèŠ‚ç‚¹å¦‚æœåœ¨åŠ å…¥å‰å·²ç»åœ¨é›†åˆé‡Œäº†, å°±è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹ä¸€å®šä¹Ÿå­˜åœ¨äºå¦ä¸€æ¡è·¯å¾„ä¸­, ä¹Ÿå³è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸ªç¥–å…ˆ, è€Œä¸”æ˜¾ç„¶**ç¬¬ä¸€æ¬¡é‡åˆ°çš„è¿™ç§èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘ç¥–å…ˆ**
- å¦‚ä½•å®ç°å‘ä¸Šèµ°å‘¢? æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª parent å­—å…¸, key æ˜¯å½“å‰èŠ‚ç‚¹, value æ˜¯å…¶çˆ¶èŠ‚ç‚¹, ç„¶åé€šè¿‡å°†å½“å‰èŠ‚ç‚¹ç½®ä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„æ–¹å¼ä¸€ç›´å‘ä¸Šèµ°äº†, ç›´åˆ°åˆ°æ ¹èŠ‚ç‚¹
- é‚£å¦‚ä½•æ±‚ parent å­—å…¸å‘¢? DFS å’Œ BFS éƒ½å¾ˆå¥½å®ç°, å› ä¸ºå®ƒä»¬éƒ½æœ‰å½“å‰èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„ä¿¡æ¯, è¿™é‡Œè¦æ±‚è¿­ä»£, é‚£å°±ç›´æ¥ç”¨ BFS å¥½äº†
- ä¸‹é¢ä»£ç å¯¹å¿…è¦æ­¥éª¤æœ‰è¯¦ç»†è§£é‡Š, æ–¹ä¾¿å¤§å®¶å‚è€ƒ

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(N): æœ€å¤šéœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹ä¸€é
- ç©ºé—´å¤æ‚åº¦ O(N): éœ€è¦å­˜æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¿¡æ¯, ä»¥åŠä¸€ä¸ªé›†åˆå­˜å½“å‰éå†è¿‡çš„èŠ‚ç‚¹

#### ä»£ç 

```python
class Solution:
    def lowestCommonAncestor(self, root: TreeNode, p: TreeNode,
                             q: TreeNode) -> TreeNode:
        # æ–¹æ³•2: è¿­ä»£BFS, è®°å½•æ¯ä¸ªèŠ‚ç‚¹çˆ¶èŠ‚ç‚¹, p/qä¾æ¬¡å‘ä¸Šæ‰¾å¹¶åŠ å…¥é›†åˆä¸­, ç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªçˆ¶èŠ‚ç‚¹å·²åœ¨é›†åˆçš„èŠ‚ç‚¹, è¿™ä¸ªçˆ¶èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ
        if not root:
            return None
        # åˆå§‹åŒ–æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºç©º
        parent = {root: None}
        # BFSéƒ¨åˆ†, è®°å½•æ¯ä¸ªèŠ‚ç‚¹çˆ¶èŠ‚ç‚¹
        queue = [root]
        for node in queue:
            if node.left:
                parent[node.left] = node
                queue.append(node.left)
            if node.right:
                parent[node.right] = node
                queue.append(node.right)
        # æ³¨æ„é›†åˆéœ€è¦åˆå§‹åŒ–åŠ ä¸Šp/q, å› ä¸ºå®ƒä»¬å¯èƒ½è‡ªèº«å°±æ˜¯ç¥–å…ˆ
        v = {p, q}
        while p or q:
            # è¿™é‡Œå¾ªç¯æ¡ä»¶ä¸ºor, å› ä¸ºæœ‰å¯èƒ½p/qé«˜åº¦å¯èƒ½ä¸åŒ, æœ‰å¯èƒ½æŸä¸ªèŠ‚ç‚¹å…ˆéå†åˆ°äº†æ ¹èŠ‚ç‚¹, è¿™æ—¶å€™å¦å¤–çš„èŠ‚ç‚¹éœ€è¦ç»§ç»­å¾€ä¸Šèµ°æ¥æ‰¾ç¥–å…ˆ
            if p:
                p = parent[p]
                if p and p in v:
                    # å½“å‰çˆ¶èŠ‚ç‚¹ä¸æ˜¯ç©ºä¸”å·²ç»åœ¨é›†åˆä¸­, è¯´æ˜å®ƒå°±æ˜¯æœ€è¿‘ç¥–å…ˆ
                    return p
                v.add(p)
            if q:
                q = parent[q]
                if q and q in v:
                    # å½“å‰çˆ¶èŠ‚ç‚¹ä¸æ˜¯ç©ºä¸”å·²ç»åœ¨é›†åˆä¸­, è¯´æ˜å®ƒå°±æ˜¯æœ€è¿‘ç¥–å…ˆ
                    return q
                v.add(q)
        # æœ€ç»ˆä¸€å®šä¼šåœ¨å¾ªç¯å†…éƒ¨è¿”å›çš„, æ‰€ä»¥å¾ªç¯å¤–ä¸éœ€è¦return, å› ä¸ºä¿åº•ç¥–å…ˆæ˜¯æ ¹èŠ‚ç‚¹, ä¸€å®šåœ¨é›†åˆä¸­
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
