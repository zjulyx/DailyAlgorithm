> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode-cn.com/problems/lru-cache-lcci/)

> ä»Šå¤©ç»§ç»­æ›´æ–°ç¨‹åºå‘˜é¢è¯•é‡‘å…¸ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ **é¢è¯•é‡‘å…¸** å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

è®¾è®¡å’Œæ„å»ºä¸€ä¸ªâ€œæœ€è¿‘æœ€å°‘ä½¿ç”¨â€ç¼“å­˜ï¼Œè¯¥ç¼“å­˜ä¼šåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚ç¼“å­˜åº”è¯¥ä»é”®æ˜ å°„åˆ°å€¼(å…è®¸ä½ æ’å…¥å’Œæ£€ç´¢ç‰¹å®šé”®å¯¹åº”çš„å€¼)ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šæœ€å¤§å®¹é‡ã€‚å½“ç¼“å­˜è¢«å¡«æ»¡æ—¶ï¼Œå®ƒåº”è¯¥åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚

å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚

- è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚
- å†™å…¥æ•°æ® put(key, value) - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚

### ç¤ºä¾‹:

```java
LRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );

cache.put(1, 1);
cache.put(2, 2);
cache.get(1);       // è¿”å›  1
cache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ
cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)
cache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ
cache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)
cache.get(3);       // è¿”å›  3
cache.get(4);       // è¿”å›  4
```

## é¢˜ç›®æ€è€ƒ

1. ç›¸å½“ç»å…¸çš„ä¸€é“é¢˜ç›®, è¦ä½¿å¾—æ›´æ–°å’ŒæŸ¥è¯¢éƒ½æ˜¯ O(1)å¤æ‚åº¦, ä½ æƒ³åˆ°äº†å“ªäº›æ•°æ®ç»“æ„ç»„åˆèƒ½åšåˆ°?

## è§£å†³æ–¹æ¡ˆ

### æ€è·¯

1. å…ˆè®¾è®¡éœ€è¦ä½¿ç”¨çš„æ•°æ®ç»“æ„
   - æ ¹æ® LRU æè¿°, æˆ‘ä»¬è‡³å°‘éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜èŠ‚ç‚¹çš„æ–°æ—§ç¨‹åº¦, æ–°çš„å¯ä»¥æ”¾ä¸€è¾¹, è€çš„æ”¾å¦ä¸€è¾¹, è¿™è‡ªç„¶å°±æ˜¯åŒå‘é“¾è¡¨
   - ä½†æ˜¯é—®é¢˜æ˜¯é“¾è¡¨è™½ç„¶æ›´æ–°å¾ˆå¿«, æ˜¯ O(1), ä½†å¦‚ä½•å¿«é€Ÿé€šè¿‡ä¸€ä¸ª key æŸ¥åˆ°å¯¹åº”çš„èŠ‚ç‚¹å‘¢?
   - å¾ˆå®¹æ˜“æƒ³åˆ°å­—å…¸/hash å¯ä»¥åšåˆ° O(1)æŸ¥è¯¢, ç„¶åè¦åšçš„å°±æ˜¯æŠŠè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„ç»“åˆèµ·æ¥:
     - åŒå‘é“¾è¡¨å­˜èŠ‚ç‚¹çš„å…ˆåé¡ºåº, head æœ€æ–°, tail æœ€è€
     - å­—å…¸å­˜ key=>èŠ‚ç‚¹çš„æ˜ å°„, æ–¹ä¾¿å¿«é€Ÿæ ¹æ® key å®šä½åˆ°èŠ‚ç‚¹
2. æ¥ä¸‹æ¥å°±æ˜¯å†™å…·ä½“çš„é€»è¾‘äº†, è¿™é‡Œä¸€å…±æœ‰ 3 ç§æ“ä½œ:
   1. get å’Œ put å·²ç»å­˜åœ¨çš„èŠ‚ç‚¹: æŠŠå·²ç»å­˜åœ¨çš„èŠ‚ç‚¹é‡æ–°æ”¾åœ¨å¤´éƒ¨
   2. put æ–°çš„èŠ‚ç‚¹: æŠŠæ–°çš„èŠ‚ç‚¹æ”¾åœ¨å¤´éƒ¨
   3. åˆ é™¤æœ€è€çš„èŠ‚ç‚¹: å¦‚æœåŠ å…¥æ–°èŠ‚ç‚¹åè¶…è¿‡ capacity, é‚£ä¹ˆéœ€è¦æŠŠæœ€è€çš„ tail ç»™å»æ‰
3. é€»è¾‘ä¼˜åŒ–
   - æ ¹æ®ç¬¬ 2 æ­¥ä¸­åˆ†æçš„ 3 ç§æ“ä½œ, æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™å‡ºæ¯ä¸€ç§æ“ä½œå¯¹åº”çš„ä»£ç , ä½†æ˜¯é‡Œé¢ä¼šæœ‰å¾ˆå¤šé‡å¤çš„éƒ¨åˆ†, æ¯”å¦‚æ”¾åœ¨å¤´éƒ¨çš„æ“ä½œåœ¨ 2.1 å’Œ 2.2 éƒ½æœ‰, è€Œåˆ é™¤èŠ‚ç‚¹çš„æ“ä½œåˆ™åœ¨ 2.1 å’Œ 2.3 éƒ½æœ‰
   - æ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è¿™ä¸¤éƒ¨åˆ†æ“ä½œæå–å‡ºæ¥
   - ä¸€ä¸ªæ˜¯ add èŠ‚ç‚¹æ“ä½œ, æŠŠèŠ‚ç‚¹æ”¾åˆ°å¤´éƒ¨, å¹¶æ›´æ–°è¿æ¥å…³ç³»å’Œå­—å…¸
   - ä¸€ä¸ªæ˜¯ remove èŠ‚ç‚¹æ“ä½œ, åˆ é™¤æŸä¸ªèŠ‚ç‚¹, å¹¶æ›´æ–°è¿æ¥å…³ç³»å’Œå­—å…¸
4. æœ€åå°±æ˜¯å…·ä½“çš„ä»£ç éƒ¨åˆ†äº†, ä¸‹é¢ä»£ç å¯¹æ¯æ­¥æ“ä½œéƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Š, å¸Œæœ›å¯ä»¥å¸®åŠ©å¤§å®¶æ›´å¥½ç†è§£

### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(1): é“¾è¡¨ä¿è¯æ›´æ–°æ˜¯ O(1), å­—å…¸ä¿è¯æŸ¥è¯¢æ˜¯ O(1)
- ç©ºé—´å¤æ‚åº¦ O(C): C æ˜¯ capacity, å­—å…¸éœ€è¦å­˜è¿™ä¹ˆå¤šä¸ª kv, æ‰€ä»¥æ˜¯ O(C)

### ä»£ç 

```python
class LRUCache:
    class BiNode:
        def __init__(self, k, v):
            self.key = k
            self.val = v
            self.pre = None
            self.nex = None

    def __init__(self, capacity: int):
        # åŒå‘é“¾è¡¨+å­—å…¸
        # åŒå‘é“¾è¡¨å­˜èŠ‚ç‚¹çš„å…ˆåé¡ºåº, headæœ€æ–°, tailæœ€è€
        # å­—å…¸æ–¹ä¾¿å¿«é€Ÿæ ¹æ®keyå®šä½åˆ°èŠ‚ç‚¹
        # æ³¨æ„é“¾è¡¨èŠ‚ç‚¹éœ€è¦å­˜keyå’Œvalue, å­˜keyçš„ç›®çš„æ˜¯ç”¨äºå­—å…¸çš„æ£€ç´¢
        # ä¸¤è€…ç»“åˆå°±èƒ½ä¿è¯æ›´æ–°å’ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1), é“¾è¡¨ä¿è¯æ›´æ–°æ˜¯O(1), å­—å…¸ä¿è¯æŸ¥è¯¢æ˜¯O(1)
        # æ³¨æ„æå–æ–°å¢å’Œç§»é™¤èŠ‚ç‚¹çš„é€»è¾‘, æ–¹ä¾¿å¤ç”¨, ç®€åŒ–ä»£ç 
        self.head = None
        self.tail = None
        self.kv = {}
        self.capacity = capacity

    def add(self, node):
        # å°†èŠ‚ç‚¹åŠ åˆ°é“¾è¡¨å¤´
        # å…ˆæ“ä½œå­—å…¸
        self.kv[node.key] = node
        # å†æ›´æ–°èŠ‚ç‚¹è¿æ¥å…³ç³»å’Œå¤´å°¾
        if not self.head:
            # æ²¡æœ‰head, è¯´æ˜å½“å‰é“¾è¡¨ä¸ºç©º, ç›´æ¥headå’Œtailéƒ½è®¾ä¸ºnodeå³å¯
            self.head = self.tail = node
        else:
            # æ›´æ–°æ–°çš„headä»¥åŠå®ƒä¸è€headçš„è¿æ¥å…³ç³»
            node.nex = self.head
            self.head.pre = node
            self.head = node

    def remove(self, node):
        # ç§»é™¤æŸä¸ªèŠ‚ç‚¹
        # å…ˆæ“ä½œå­—å…¸
        if node.key in self.kv:
            del self.kv[node.key]
        # å†æ›´æ–°èŠ‚ç‚¹è¿æ¥å…³ç³»å’Œå¤´å°¾
        # æ›´æ–°å·¦å³é‚»å±…çš„è¿æ¥å…³ç³»
        pre, nex = node.pre, node.nex
        # æ³¨æ„å½“å‰èŠ‚ç‚¹çš„preå’Œnexéƒ½è¦é‡ç½®ä¸ºNone
        node.pre = node.nex = None
        if pre:
            pre.nex = nex
        if nex:
            nex.pre = pre
        # æ›´æ–°æ–°çš„å¤´å°¾
        if node == self.head:
            self.head = nex
        if node == self.tail:
            self.tail = pre

    def get(self, key: int) -> int:
        # æ³¨æ„getæ“ä½œä¹Ÿéœ€è¦å°†nodeæ›´æ–°åˆ°é“¾è¡¨å¤´
        if key in self.kv:
            node = self.kv[key]
            # å…ˆæŠŠnodeä»å½“å‰ä½ç½®ç§»é™¤, ç„¶ååŠ å…¥å¤´éƒ¨
            self.remove(node)
            self.add(node)
            return node.val
        return -1

    def put(self, key: int, value: int) -> None:
        if self.capacity <= 0:
            # å¦‚æœcapacityæ˜¯0, ç›´æ¥æ— æ³•æ·»åŠ 
            return
        if key in self.kv:
            # å¦‚æœå½“å‰keyå­˜åœ¨çš„è¯, å…ˆç§»é™¤å®ƒ
            self.remove(self.kv[key])
        elif len(self.kv) == self.capacity:
            # æ³¨æ„å¦‚æœå½“å‰å·²ç»è¾¾åˆ°capacityçš„è¯å…ˆç§»é™¤tail
            self.remove(self.tail)
        # åŠ å…¥æ–°èŠ‚ç‚¹åˆ°å¤´éƒ¨
        newNode = self.BiNode(key, value)
        self.add(newNode)
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
