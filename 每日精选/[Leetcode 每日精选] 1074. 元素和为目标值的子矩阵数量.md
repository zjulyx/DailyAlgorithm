> é¢˜ç›®éš¾åº¦: å›°éš¾

> [åŸé¢˜é“¾æ¥](https://leetcode-cn.com/problems/number-of-submatrices-that-sum-to-target/)

> ä»Šå¤©æˆ‘ä»¬æ¥æŒ‘æˆ˜ä¸€ä¸‹, åšé“å›°éš¾é¢˜å§~ æˆ‘è§‰å¾—å¤§å®¶å¦‚æœæŠŠè¿™é“é¢˜å½»åº•å¼„æ‡‚çš„è¯, å¤§éƒ¨åˆ†è·Ÿå‰ç¼€å’Œç›¸å…³çš„é—®é¢˜å°±éƒ½èƒ½è¿åˆƒè€Œè§£äº†

## é¢˜ç›®æè¿°

ç»™å‡ºçŸ©é˜µ Â matrixÂ  å’Œç›®æ ‡å€¼ Â targetï¼Œè¿”å›å…ƒç´ æ€»å’Œç­‰äºç›®æ ‡å€¼çš„éç©ºå­çŸ©é˜µçš„æ•°é‡ã€‚

å­çŸ©é˜µ Â x1, y1, x2, y2Â  æ˜¯æ»¡è¶³ x1 <= x <= x2Â  ä¸” Â y1 <= y <= y2Â  çš„æ‰€æœ‰å•å…ƒ Â matrix[x][y]Â  çš„é›†åˆã€‚

å¦‚æœ Â (x1, y1, x2, y2) å’Œ Â (x1', y1', x2', y2')Â  ä¸¤ä¸ªå­çŸ©é˜µä¸­éƒ¨åˆ†åæ ‡ä¸åŒï¼ˆå¦‚ï¼šx1 != x1'ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­çŸ©é˜µä¹Ÿä¸åŒã€‚

- 1 <= matrix.length <= 300
- 1 <= matrix[0].length <= 300
- -1000 <= matrix[i] <= 1000
- -10^8 <= target <= 10^8

## é¢˜ç›®æ ·ä¾‹

### ç¤ºä¾‹ 1

#### è¾“å…¥

matrix = [[0,1,0],[1,1,1],[0,1,0]], target = 0

#### è¾“å‡º

4

#### è§£é‡Š

å››ä¸ªåªå« 0 çš„ 1x1 å­çŸ©é˜µã€‚

### ç¤ºä¾‹ 2

#### è¾“å…¥

matrix = [[1,-1],[-1,1]], target = 0

#### è¾“å‡º

5

#### è§£é‡Š

ä¸¤ä¸ª 1x2 å­çŸ©é˜µï¼ŒåŠ ä¸Šä¸¤ä¸ª 2x1 å­çŸ©é˜µï¼Œå†åŠ ä¸Šä¸€ä¸ª 2x2 å­çŸ©é˜µã€‚

## é¢˜ç›®æ€è€ƒ

1. æŒ‰æƒ¯ä¾‹å…ˆçœ‹æ•°æ®è§„æ¨¡, ä»è§„æ¨¡ä¸Šçœ‹ O(R^2\*C^2)çš„ç®—æ³•å¤§æ¦‚ç‡ä¼šè¶…æ—¶, å› ä¸ºæœ€å¤§æ•°æ®é‡å·²ç»æ˜¯ 9W\*9W äº†
2. å¯ä»¥è¿›è¡Œå“ªäº›é¢„å¤„ç†?

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1

#### æ€è·¯

- æœ€ naive çš„æ–¹æ³•, æ ¹æ®æœ¬é¢˜æè¿°, å¾ˆå®¹æ˜“è”æƒ³åˆ°æ•°ç»„çš„å‰ç¼€å’Œ, åªæ˜¯æŠŠä¸€ç»´æ•°ç»„æ¢æˆäº†äºŒç»´çŸ©é˜µè€Œå·²
- å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå‰ç¼€å’Œå­—å…¸ d, d[r,c]å­˜å·¦ä¸Šè§’åˆ°(r,c)çš„çŸ©é˜µå’Œ, é‚£ä¹ˆä»»æ„ä¸€ä¸ªå­çŸ©é˜µ[(sr,sc),(er,ec)]çš„å’Œéƒ½å¯ä»¥æ±‚å‡ºäº†
- å¤§å®¶å¯ä»¥ç”»ä¸ªå›¾æ¥ç†è§£, å­çŸ©é˜µ[(sr,sc),(er,ec)]æ˜¯å­çŸ©é˜µ[(0,0),(er,ec)]çš„å³ä¸‹è§’çŸ©å½¢, æƒ³è¦æ±‚å‡ºå®ƒ, æˆ‘ä»¬åªéœ€è¦æ ¹æ®[(0,0),(er,ec)]çš„å’Œ, å‡å»ä¸ŠåŠéƒ¨åˆ†çš„çŸ©å½¢, å†å‡å»å·¦åŠéƒ¨åˆ†çš„çŸ©å½¢, æœ€ååŠ ä¸Šå·¦ä¸Šè§’è¢«é‡å¤å‡äº†ä¸¤æ¬¡çš„çŸ©å½¢å³å¯
- å…·ä½“å°±æ˜¯`sum((sr,sc),(er,ec)) = d[er,ec]-d[sr,ec]-d[er,sc]+d[sr,sc]`
- è‡³äºå¦‚ä½•æ±‚å‰ç¼€å’Œå­—å…¸ d æœ¬èº«, ä¹Ÿå¯ä»¥åˆ©ç”¨åŒæ ·çš„æ€è·¯: `d[r,c] = matrix[r][c]+d[r-1,c]+d[r,c-1]-d[r-1,c-1]`
- **æ³¨æ„: å› ä¸ºå¤æ‚åº¦è¿‡é«˜, ä¼š TLE, æ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆåªæ˜¯ä½œä¸ºæ¨å¯¼ä¸‹é¢æ›´ä¼˜æ–¹æ¡ˆçš„åŸºç¡€. ä»£ç ä¹Ÿå°±ä¸è´´äº†, ç›¸ä¿¡å¤§å®¶éƒ½èƒ½å†™å‡ºæ¥~**

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(R\*C\*R\*C): é¢„å¤„ç†éœ€è¦ O(R\*C), è®¡ç®—ç»“æœæ—¶éœ€è¦å››é‡å¾ªç¯, å›ºå®šèµ·ç‚¹ rc ä»¥åŠç»ˆç‚¹ rc, æ‰€ä»¥æ€»æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(R\*C\*R\*C)
- ç©ºé—´å¤æ‚åº¦ O(R\*C): éœ€è¦ 1 ä¸ªå¤§å°ä¸º R\*C çš„å­—å…¸, ç”¨äºå­˜æ”¾å‰ç¼€å’Œ

### æ–¹æ¡ˆ 2

#### æ€è·¯

- å›é¡¾æ–¹æ¡ˆ 1, æˆ‘ä»¬æ˜¯ç»Ÿè®¡äº†æ‰€æœ‰åæ ‡çš„å‰ç¼€å’Œ, è™½ç„¶é¢„å¤„ç†çš„æ—¶é—´å¤æ‚åº¦è¿˜å¯ä»¥, ä½†æ˜¯è®¡ç®—ç»“æœæ—¶åªèƒ½æš´åŠ› 4 é‡å¾ªç¯å®åœ¨å¤ªæ…¢äº†
- å¦‚ä½•è¿›è¡Œä¼˜åŒ–? æ˜¯å¦å¯ä»¥é€‚ç”¨äºä¸€ç»´æ•°ç»„çš„ä¸€äº›æ–¹æ³•?
- æ ¹æ®ä¸Šé¢æ€è€ƒ, æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠåŸæ¥å­˜åœ¨å‰ç¼€å’Œå­—å…¸çš„ä¸œè¥¿ç»™å˜æ¢ä¸€ä¸‹, ä»¥è¡Œæˆ–è€…åˆ—ä¸ºå•ä½, åªå­˜è¯¥è¡Œæˆ–è€…åˆ—ä»å¼€å¤´åˆ°å½“å‰å…ƒç´ çš„å‰ç¼€å’Œ, ç›¸å½“äºæŠŠäºŒç»´çŸ©é˜µå‹ç¼©æˆä¸€ç»´çš„æ•°ç»„
- è¿™æ ·è®¡ç®—çš„æ—¶å€™å°±å¯ä»¥åˆ©ç”¨å­æ•°ç»„å’Œçš„æ±‚æ³•, äºŒé‡å¾ªç¯å¤–å†æ¥ä¸€ä¸ª O(N)çš„å¾ªç¯å³å¯
- ä¸¾ä¸ªä¾‹å­, å‡è®¾æˆ‘ä»¬ä»¥åˆ—ä¸ºå•ä½æ±‚å‰ç¼€å’Œ, `colsm[r,c]`è¡¨ç¤ºç¬¬ r è¡Œä¸­åˆ°ç¬¬ c ä¸ªå…ƒç´ çš„å’Œ, é‚£ä¹ˆ `colsm[r,x] = matrix[r][0]+matrix[r][1]+...+matrix[r][x]`
- ç„¶åæˆ‘ä»¬å›ºå®šè¡Œçš„èµ·ç‚¹ sr å’Œç»ˆç‚¹ er, ç„¶åä» 0 å¼€å§‹éå†åˆ—, è®¡ç®— `matrix[er][c]-matrix[sr-1][c]`çš„å‰ç¼€å’Œ, ç›¸å½“äºæŠŠä¸€åˆ—åˆ—æ‹¼æˆä¸€ä¸ªå­çŸ©é˜µ, äºŒç»´å˜ä¸€ç»´æ•°ç»„, è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æ˜¯å°±å¾ˆç†Ÿæ‚‰äº†?
- å¯¹çš„! è¿™ä¸ªå°±æ˜¯ç»å…¸å­æ•°ç»„å’Œé—®é¢˜äº†: [560. å’Œä¸º K çš„å­æ•°ç»„](https://leetcode-cn.com/problems/subarray-sum-equals-k/), è¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡è¯¦ç»†è§£æ, æ„Ÿå…´è¶£çš„åŒå­¦å…³æ³¨æˆ‘çš„å…¬ä¼—å·:**æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜**, ç„¶åå›å¤*å­æ•°ç»„å’Œ*å°±èƒ½çœ‹åˆ°å•¦~~
- æ­¤æ—¶æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªè®¡æ•°å­—å…¸, ä»¥å½“å‰å‰ç¼€å’Œä½œä¸º key, value æ˜¯å½“å‰å‰ç¼€å’Œçš„ä¸ªæ•°, å¦‚æœå½“å‰å‰ç¼€å’Œ-target åœ¨å­—å…¸ä¸­, å°±åœ¨ç»“æœä¸­åŠ ä¸Šå¯¹åº”çš„è®¡æ•°å€¼, å› ä¸ºå¯¹åº”çš„æ¯ä¸ªä¸­é—´çŸ©å½¢çš„å’Œéƒ½æ˜¯ target, åŒæ—¶ä¸è¦å¿˜äº†å½“å‰å‰ç¼€å’Œæœ¬èº«å°±æ˜¯ target çš„æƒ…å†µ, è¿™æ—¶å€™ç›´æ¥ç»“æœ+1 å³å¯

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(R\*C\*min(R,C)): é¢„å¤„ç†éœ€è¦ O(R\*C), ç»Ÿè®¡å‰ç¼€å’Œçš„æ—¶å€™å¯ä»¥ä»å·¦å‘å³ç»Ÿè®¡(ä½¿ç”¨èµ·ç‚¹å’Œç»ˆç‚¹ R, ä¸¤ä¸ª R å¾ªç¯), ä¹Ÿå¯ä»¥ä»ä¸Šå¾€ä¸‹ç»Ÿè®¡(ä½¿ç”¨èµ·ç‚¹å’Œç»ˆç‚¹ C, ä¸¤ä¸ª C å¾ªç¯), æ‰€ä»¥ä¼˜åŒ–ç®—æ³•æ˜¯ O(R\*C\*min(R,C)), æ­¤å¤„ä»£ç æ²¡æœ‰ä½¿ç”¨æ­¤ä¼˜åŒ–, åªæ¼”ç¤ºäº†ä»å·¦å‘å³ç»Ÿè®¡, æ‰€ä»¥ä»£ç å¤æ‚åº¦æ˜¯ O(R\*R\*C)
- ç©ºé—´å¤æ‚åº¦ O(R\*C): éœ€è¦ä¸€ä¸ªå¤§å°ä¸º R\*C çš„å­—å…¸, ç”¨äºå­˜æ”¾å‰ç¼€å’Œ

#### ä»£ç 

##### Python 3

```python
import collections


class Solution:
    def numSubmatrixSumTarget(self, matrix: List[List[int]],
                              target: int) -> int:
        rows, cols = len(matrix), len(matrix[0])
        colsm = [[0] * cols for r in range(rows)]
        for c in range(cols):
            cur = 0
            for r in range(rows):
                cur += matrix[r][c]
                colsm[r][c] = cur
        res = 0
        for sr in range(rows):
            for er in range(sr, rows):
                d = collections.defaultdict(int)
                cur = 0
                for c in range(cols):
                    # æ³¨æ„æ­¤å¤„å‡å»çš„æ˜¯colsm[sr - 1][c], å› ä¸ºè¦æŠŠèµ·ç‚¹è¡Œsrç»Ÿè®¡åœ¨å†…
                    pre = 0 if sr - 1 < 0 else colsm[sr - 1][c]
                    cur += colsm[er][c] - pre
                    if cur == target:
                        # curæœ¬èº«å°±æ˜¯targetçš„ç‰¹æ®Šæƒ…å†µ
                        res += 1
                    res += d[cur - target]
                    d[cur] += 1
        return res
```

##### C++

```cpp
class Solution {
public:
    int numSubmatrixSumTarget(vector<vector<int>> &matrix, int target) {
        int rows = matrix.size();
        int cols = matrix[0].size();

        vector<vector<int>> colsm(rows, vector<int>(cols, 0));

        for (int c = 0; c < cols; ++c) {
            int total = 0;
            for (int r = 0; r < rows; ++r) {
                total += matrix[r][c];
                colsm[r][c] = total;
            }
        }

        int res = 0;

        for (int sr = 0; sr < rows; ++sr) {
            for (int er = sr; er < rows; ++er) {
                int total = 0;
                unordered_map<int, int> d;
                for (int c = 0; c < cols; ++c) {
                    int pre = sr < 1 ? 0 : colsm[sr - 1][c];
                    total += colsm[er][c] - pre;
                    if (total == target) {
                        ++res;
                    }
                    if(d.count(total - target)) {
                        res += d[total - target];
                    }
                    d[total] += 1;
                }
            }
        }

        return res;
    }
};
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„ç®€ä¹¦](https://www.jianshu.com/u/3a17f1fdfd67)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜, æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://mmbiz.qpic.cn/mmbiz_jpg/1KjZicMlYPMgZWmoL4eYcs6UcfmvsetDWME2YJyaCp9oT9z3U573FWENBNhyOByxYI0epew6O37hiaOhdh90QeJg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
