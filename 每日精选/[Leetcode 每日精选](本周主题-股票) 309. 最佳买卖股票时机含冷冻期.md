> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/)

> ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¥åšè‚¡ç¥¨é—®é¢˜, åœ¨åšè‚¡ç¥¨ç³»åˆ—çš„ä¸¤é“å›°éš¾é¢˜(III å’Œ IV)ä¹‹å‰, æˆ‘ä»¬å…ˆæ¥åšåŒ…å«"å†·å†»æœŸ"æˆ–"æ‰‹ç»­è´¹"çš„è¿™ä¸¤é“ä¸­ç­‰é¢˜, è®©éš¾åº¦è·¨åº¦æ²¡é‚£ä¹ˆå¤§, ä»Šå¤©å°±å…ˆæ¥åšåŒ…å«å†·å†»æœŸçš„è¿™é“å§. å¤§å®¶åœ¨æˆ‘çš„å…¬ä¼—å·"æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜"ä¸­çš„èŠå¤©æ¡†ä¸­å›å¤ **è‚¡ç¥¨** å°±èƒ½çœ‹åˆ°äº†å½“å‰å·²ç»æ›´æ–°çš„è‚¡ç¥¨ç³»åˆ—äº†

> å¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•å»ºè®®å’Œåé¦ˆçš„è¯æ¬¢è¿éšæ—¶äº¤æµ, åŒ…æ‹¬ä½†ä¸é™äºå…¬ä¼—å·èŠå¤©æ¡†/çŸ¥ä¹ç§ä¿¡è¯„è®ºç­‰ç­‰~

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ Â iÂ  ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ Â iÂ  å¤©çš„è‚¡ç¥¨ä»·æ ¼ ã€‚â€‹

è®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:

ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚
å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)ã€‚

## é¢˜ç›®æ ·ä¾‹

### ç¤ºä¾‹

#### è¾“å…¥

[1,2,3,0,2]

#### è¾“å‡º

3

#### è§£é‡Š

- å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]

## é¢˜ç›®æ€è€ƒ

1. ç›¸æ¯”æ˜¨å¤©çš„æ— é™ä¹°å–çš„é¢˜ç›®, è¿™é“é¢˜å¤šäº†ä¸ªå†·å†»æœŸçš„é™åˆ¶, æˆ‘ä»¬è¿˜èƒ½å†æ¬¡åˆ©ç”¨è´ªå¿ƒæ³•å—?
2. å¦‚æœä¸èƒ½åˆ©ç”¨è´ªå¿ƒæ³•, è¿˜æœ‰ä»€ä¹ˆå…¶ä»–æ€è·¯å—?

## è§£å†³æ–¹æ¡ˆ

### æ€è·¯

- **åˆ†æ**
  - ç”±äºå¼•å…¥äº†å†·å†»æœŸ, æˆ‘ä»¬ä¸èƒ½åƒä¹‹å‰çš„æ— é™ä¹°å–é‚£æ ·æ¯æ¬¡éƒ½åŠ ç›¸é‚»çš„æ­£æ”¶ç›Šäº†, å› ä¸ºä¸¤æ¬¡ä¹°å–ä¸­é—´è‡³å°‘è¦éš”ä¸€å¤©, è€Œåº”è¯¥åœ¨å“ªäº›å¤©ä¹°å…¥å’Œå–å‡º, å°±ä¸èƒ½åƒè´ªå¿ƒæ³•åˆ†æçš„é‚£æ ·ç®€å•äº†
  - è§‚å¯Ÿå†·å†»æœŸçš„æ¦‚å¿µ, è™½ç„¶å½“å‰å¤©ä¸èƒ½åŸºäºå‰ä¸€å¤©çš„ç»“æœæ¥è®¡ç®—, ä½†å¯ä»¥ä½¿ç”¨æ›´æ—©çš„ç»“æœ. ä¾‹å¦‚æˆ‘ä»¬ç¬¬ i å¤©è¦å–å‡º, é‚£ä¹ˆä¸Šä¸€æ¬¡å–å‡ºçš„æ—¶é—´æœ€æ™šå¾—ä¸º **i-3**, è¿™æ ·å†·å´ä¸€å¤©å, ç¬¬ i-1 å¤©å†æ¬¡ä¹°å…¥, ç¬¬ i å¤©æ‰èƒ½å–å‡º. è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ€è·¯, æ‰¾åˆ°è½¬ç§»æ–¹ç¨‹å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜
- **æ¨å¯¼**
  - è®¾ dp[i]è¡¨ç¤º**åœ¨ç¬¬ i å¤©å–å‡º**æ—¶èƒ½è·å¾—çš„æœ€å¤§æ”¶ç›Š, æ³¨æ„å¯èƒ½ç¬¬ i å¤©æ˜¯ä¸€ä¸ªä½ä½, è¿™ç§æƒ…å†µä¸‹ dp[i]çš„ç»“æœå¯èƒ½å¾ˆå°, æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆç»“æœåº”è¯¥æ˜¯æ‰€æœ‰ dp å€¼ä¸­çš„æœ€å¤§å€¼
  - æˆ‘ä»¬ä»ç„¶éœ€è¦ç»´æŠ¤ mnprice, è¡¨ç¤ºå½“å‰ i å¤©ä¹‹å‰çš„æœ€ä½ä»·æ ¼. ä½†æ˜¯è¿™ä¸ªæœ€ä½ä»·æ ¼**ä¸èƒ½**å’Œä¹‹å‰ä¸€æ ·ä»£è¡¨`[0:i-1]`çš„æœ€ä½ä»·æ ¼äº†, å› ä¸ºåœ¨è¿™ä¸ªåŒºé—´å†…æˆ‘ä»¬å¯èƒ½å·²ç»æœ‰å¾ˆå¤šæ¬¡ä¹°å–, mnprice å¯èƒ½å·²ç»è¢«ç”¨è¿‡äº†, ä¸èƒ½å†è¢«é‡å¤åˆ©ç”¨. æ‰€ä»¥å®ƒåº”è¯¥æ˜¯`[j:i-1]`ä¹‹é—´çš„æœ€ä½ä»·æ ¼, j æ˜¯ä¸Šæ¬¡å–å‡ºçš„æ—¥æœŸ
  - è‡³äºå¦‚ä½•ç¡®å®š j, æˆ‘ä»¬éœ€è¦é¢å¤–å¼•å…¥ä¸€ä¸ªå˜é‡ mxdp, è¡¨ç¤ºåœ¨ i-3 å¤©åŠä¹‹å‰çš„æœ€å¤§ dp å€¼ (ä¸ºä»€ä¹ˆæ˜¯ i-3? å¯ä»¥å‚è€ƒä¸Šé¢çš„åˆ†æ). å¦‚æœå½“å‰çš„ dp[i-3]æ¯”ä¹‹å‰çš„ mxdp å¤§çš„è¯, æˆ‘ä»¬å°±æ›´æ–° mxdp å’Œ mnprice(æ­¤æ—¶æ–°çš„ mnprice åªèƒ½ä¸º prices[i-1] äº†)
  - æ ¹æ®ä¸Šé¢åˆ†æ, ç¬¬ i å¤©å–å‡ºçš„æœ€å¤§æ”¶ç›Šä¸º `dp[i] = max(mxdp + prices[i] - mnprice)`. ç”±äº prices[i]æ˜¯å›ºå®šçš„, æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ±‚ `max(mxdp - mnprice)`. å¯ä»¥å°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªæ•´ä½“, å†å¼•å…¥ä¸€ä¸ªå˜é‡ mxdiff æ¥æ±‚æˆªæ­¢åˆ° i å¤©çš„æœ€å¤§ `mxdp - mnprice` å³å¯, è¿™æ · dp[i] å°±ç­‰äº `prices[i] + mxdiff`. (å› ä¸ºä¸ä¸€å®š i-3 å¤©å–å‡ºå°±æ˜¯ä¹‹å‰æ‰€èƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š, æœ‰å¯èƒ½æ›´æ—©å–å‡ºæ‰æ˜¯)
- **æ€»ç»“**
  - æ ¹æ®ä¸Šé¢çš„åˆ†æå’Œæ¨å¯¼, å¯ä»¥å¾—å‡ºè½¬ç§»æ–¹ç¨‹å°±æ˜¯`dp[i] = max(mxdp + prices[i] - mnprice) = prices[i] + mxdiff`, è¿™ä¸ªå°±æ˜¯æœ€æœ€ä¸»è¦çš„è½¬ç§»æ–¹ç¨‹, ä¹Ÿæ˜¯æ•´ä¸ªè‚¡ç¥¨ç³»åˆ—çš„æ ¸å¿ƒ, åœ¨æ¥ä¸‹æ¥çš„è‚¡ç¥¨é—®é¢˜ä¸­è¿˜ä¼šå¤šæ¬¡è¢«ç”¨åˆ°. å¤§å®¶å¦‚æœæœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥é€šè¿‡æ–‡ç« å¼€å¤´çš„è”ç³»æ–¹å¼è·Ÿæˆ‘äº¤æµ.
  - ä¸‹é¢çš„ä»£ç ä¸­å¯¹æ¯ä¸€æ­¥æœ‰è¯¦ç»†çš„æ³¨é‡Š, å¸®åŠ©å¤§å®¶ç†è§£~

### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(N): éœ€è¦éå†æ•´ä¸ªæ•°ç»„ä¸€é
- ç©ºé—´å¤æ‚åº¦ O(N): dp æ•°ç»„çš„é•¿åº¦, æ³¨æ„ dp æ•°ç»„å¯ä»¥åªä¿ç•™ 4 ä¸ªå…ƒç´ , å³åˆ° i-3 å¤©çš„ dp å€¼, è¿™æ ·å¯ä»¥æŠŠç©ºé—´å¤æ‚åº¦é™ä¸º O(1), æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå°è¯•

### ä»£ç 

#### Python 3

```python
class Solution:
    def maxProfit(self, prices: List[int]) -> int:
        # dp[i]è¡¨ç¤ºç¬¬iå¤©å–å‡ºè‚¡ç¥¨èƒ½è·å¾—çš„æœ€å¤§æ”¶ç›Š
        n = len(prices)
        dp = [0] * n
        # mnprice - ä¸Šä¸€æ¬¡å–å‡ºä¹‹ååˆ°å½“å‰çš„æœ€ä½ä»·æ ¼
        # mxdp - i-3å¤©åŠä¹‹å‰æ‰€èƒ½è·å¾—çš„æœ€é«˜æ”¶ç›Š
        # mxdiff - æœ€å¤§çš„mxdp-mnprice
        mnprice, mxdiff, mxdp = float('inf'), -float('inf'), 0
        res = 0
        for i in range(1, n):
            # æ›´æ–°æœ€ä½ä»·æ ¼
            mnprice = min(mnprice, prices[i - 1])
            if i - 3 >= 0 and dp[i - 3] > mxdp:
                # å½“å‰dp[i-3]æ¯”mxdpæ›´å¤§, æ›´æ–°å®ƒ
                mxdp = dp[i - 3]
                # åŒæ—¶mnpriceä¹Ÿè¦è¢«æ›´æ–°, å› ä¸ºä¸Šä¸€æ¬¡å–å‡ºæ˜¯i-3, ç°åœ¨å¯èƒ½å€¼åªèƒ½æ˜¯prices[i-1]äº†
                mnprice = prices[i - 1]
            # æ›´æ–°mxdp - mnpriceè¿™ä¸ªæ•´ä½“çš„æœ€å¤§å€¼
            mxdiff = max(mxdiff, mxdp - mnprice)
            # å½“å‰dpå°±æ˜¯prices[i] + mxdiff
            dp[i] = prices[i] + mxdiff
            # æ›´æ–°æœ€ç»ˆç»“æœ
            res = max(res, dp[i])
        return res
```

#### C++

```cpp
class Solution {
public:
    int maxProfit(vector<int>& prices) {
        int res = 0;
        vector<int> dp(prices.size(), 0);
        int minPrice = INT_MAX, maxDiff = INT_MIN, maxdp = 0;

        for (int i = 1; i < prices.size(); ++i) {
            minPrice = min(minPrice, prices[i - 1]);
            if (i - 3 >= 0 && dp[i - 3] > maxdp) {
                maxdp = dp[i - 3];
                minPrice = prices[i - 1];
            }
            maxDiff = max(maxDiff, maxdp - minPrice);
            dp[i] = prices[i] + maxDiff;
            res = max(res, dp[i]);
        }

        return res;
    }
};
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„ç®€ä¹¦](https://www.jianshu.com/u/3a17f1fdfd67)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜, æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![æ¯æ—¥ç²¾é€‰ç®—æ³•é¢˜ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://mmbiz.qpic.cn/mmbiz_jpg/1KjZicMlYPMgZWmoL4eYcs6UcfmvsetDWME2YJyaCp9oT9z3U573FWENBNhyOByxYI0epew6O37hiaOhdh90QeJg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
