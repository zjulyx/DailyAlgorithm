> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode.cn/problems/z1R5dt/)

> ä»Šå¤©ç»§ç»­æ›´æ–° Leetcode çš„å‰‘æŒ‡ Offerï¼ˆä¸“é¡¹çªå‡»ç‰ˆï¼‰ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ `å‰‘æŒ‡offer2` å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ª MapSum ç±»ï¼Œæ”¯æŒä¸¤ä¸ªæ–¹æ³•ï¼Œinsert å’Œ sumï¼š

- MapSum() åˆå§‹åŒ– MapSum å¯¹è±¡
- void insert(String key, int val) æ’å…¥ key-val é”®å€¼å¯¹ï¼Œå­—ç¬¦ä¸²è¡¨ç¤ºé”® key ï¼Œæ•´æ•°è¡¨ç¤ºå€¼ val ã€‚å¦‚æœé”® key å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆåŸæ¥çš„é”®å€¼å¯¹å°†è¢«æ›¿ä»£æˆæ–°çš„é”®å€¼å¯¹ã€‚
- int sum(string prefix) è¿”å›æ‰€æœ‰ä»¥è¯¥å‰ç¼€ prefix å¼€å¤´çš„é”® key çš„å€¼çš„æ€»å’Œã€‚

### ç¤ºä¾‹ï¼š

- è¾“å…¥ï¼š
  - inputs = ["MapSum", "insert", "sum", "insert", "sum"]
  - inputs = [[], ["apple", 3], ["ap"], ["app", 2], ["ap"]]
- è¾“å‡ºï¼š
  - [null, null, 3, null, 5]
- è§£é‡Šï¼š
  - MapSum mapSum = new MapSum();
  - mapSum.insert("apple", 3);
  - mapSum.sum("ap"); // return 3 (apple = 3)
  - mapSum.insert("app", 2);
  - mapSum.sum("ap"); // return 5 (apple + app = 3 + 2 = 5)

### æç¤ºï¼š

- 1 <= key.length, prefix.length <= 50
- key å’Œ prefix ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
- 1 <= val <= 1000
- æœ€å¤šè°ƒç”¨ 50 æ¬¡ insert å’Œ sum

## é¢˜ç›®æ€è€ƒ

1. å¦‚ä½•ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦?

## è§£å†³æ–¹æ¡ˆ

#### æ€è·¯

- åˆ†æé¢˜ç›®, ä¸€ä¸ªæœ€ç›´æ¥çš„æ€è·¯å°±æ˜¯, ä½¿ç”¨ä¸€ä¸ªå­—å…¸å­˜å‚¨æ‰€æœ‰ key-val é”®å€¼å¯¹
- è¿™æ · insert æ—¶ç›´æ¥æ›´æ–°å­—å…¸å³å¯, è€Œé’ˆå¯¹ sum æ“ä½œ, éå†å­—å…¸çš„æ‰€æœ‰ key, å¦‚æœå®ƒçš„å‰ç¼€æ˜¯ prefix çš„è¯, å°±ç´¯åŠ å®ƒçš„å€¼, æœ€ç»ˆè¿”å›ç´¯åŠ çš„å’Œ
- ä¸è¿‡è¿™æ · sum æ“ä½œçš„å¤æ‚åº¦æœ‰ç‚¹é«˜, æ¯æ¬¡éƒ½éœ€è¦éå†å­˜å‚¨çš„æ‰€æœ‰ key, æœ‰æ²¡æœ‰æ›´é«˜æ•ˆçš„æ–¹æ³•å‘¢?
- åœ¨ä¹‹å‰çš„é¢˜ç›®ä¸­, æˆ‘ä»¬å·²ç»äº†è§£åˆ°, å­—å…¸æ ‘ trie å¯ä»¥ç”¨æ¥è§£å†³å‰ç¼€é—®é¢˜ ([Leetcode å‰‘æŒ‡ Offer II 062. å®ç° Trie (å‰ç¼€æ ‘)](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484734&idx=1&sn=c8f9ff3725bd6a41647bf1dba47d9dce&token=1922837604&lang=zh_CN#rd) / [Leetcode å‰‘æŒ‡ Offer II 063. å•è¯æ›¿æ¢](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484739&idx=1&sn=cf8e2e1b720712cfcbe3cd092e10d476&token=1214673232&lang=zh_CN#rd))
- è¿™é“é¢˜ä¹Ÿä¸ä¾‹å¤–, æˆ‘ä»¬åªéœ€è¦ç¨ä½œæ”¹åŠ¨, æ¯ä¸ªèŠ‚ç‚¹é¢å¤–ä¿å­˜å½“å‰çš„å€¼æ€»å’Œ sum, åŒæ—¶ä¹Ÿä¸éœ€è¦ isWord æ ‡è®°äº†
- å¦å¤–æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç»´æŠ¤ key-val å­—å…¸, ç”¨äºå¤„ç†æ›´æ–°å·²æœ‰ key çš„æƒ…å†µ
- åœ¨æ‰§è¡Œ insert(key, val) æ“ä½œæ—¶:
  - é¦–å…ˆè®¡ç®—å½“å‰ key å¯¹åº”çš„æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å¢åŠ çš„å€¼ diff
    - å¦‚æœ key åœ¨å­—å…¸ä¸­, åˆ™ diff å°±æ˜¯æ–°å€¼å‡å»æ—§å€¼
    - å¦‚æœ key ä¸åœ¨å­—å…¸ä¸­, åˆ™ diff å°±æ˜¯ val
  - ç„¶åç»´æŠ¤å½“å‰èŠ‚ç‚¹, åˆå§‹åŒ–ä¸ºæ ¹
  - éå†å•è¯çš„æ¯ä¸ªå­—ç¬¦, å¦‚æœå½“å‰èŠ‚ç‚¹ä¸å­˜åœ¨ä¸€ä¸ªå¯¹åº”å­—ç¬¦çš„å­èŠ‚ç‚¹æ—¶, å°±åˆ›å»ºå®ƒ
  - ç„¶åå°†å½“å‰èŠ‚ç‚¹æŒ‡å‘å¯¹åº”çš„å­èŠ‚ç‚¹, åŒæ—¶å°†èŠ‚ç‚¹çš„ sum ç´¯åŠ ä¹‹å‰è®¡ç®—å¥½çš„ diff, ç»§ç»­è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°éå†ç»“æŸ
- åœ¨æ‰§è¡Œ sum(prefix) æ“ä½œæ—¶:
  - ç»´æŠ¤å½“å‰èŠ‚ç‚¹, åˆå§‹åŒ–ä¸ºæ ¹
  - ç„¶åéå†å¾…æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦, å¦‚æœå½“å‰èŠ‚ç‚¹ä¸å­˜åœ¨ä¸€ä¸ªå¯¹åº”å­—ç¬¦çš„å­èŠ‚ç‚¹æ—¶, è¯´æ˜ä¸å­˜åœ¨ä»¥ prefix ä¸ºå‰ç¼€çš„ key, ç›´æ¥è¿”å› 0
  - å¦åˆ™å°†å½“å‰èŠ‚ç‚¹æŒ‡å‘å¯¹åº”çš„å­èŠ‚ç‚¹, ç»§ç»­è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°éå†ç»“æŸ
  - æ­¤æ—¶çš„å½“å‰èŠ‚ç‚¹çš„ sum å°±æ˜¯ä»¥è¯¥å‰ç¼€ prefix å¼€å¤´çš„é”® key çš„å€¼çš„æ€»å’Œ, è¿”å›å®ƒ
- ä¸‹é¢ä»£ç ä¸­æœ‰è¯¦ç»†çš„æ³¨é‡Š, æ–¹ä¾¿å¤§å®¶ç†è§£

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(C): å‡è®¾ C æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²çš„å¹³å‡é•¿åº¦, insert å’Œ sum æ“ä½œéƒ½åªéœ€è¦å¯¹å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦æ“ä½œä¸€æ¬¡
- ç©ºé—´å¤æ‚åº¦ O(NC): å‡è®¾ N æ˜¯ insert æ“ä½œçš„æ¬¡æ•°, æœ€å·®æƒ…å†µä¸‹, kv å­—å…¸éœ€è¦å­˜æ‰€æœ‰å­—ç¬¦ä¸², trie éœ€è¦å­˜æ¯ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦

#### ä»£ç 

```python
# trie+kvå­—å…¸
class Node:
    def __init__(self):
        self.children = {}
        # è®°å½•å½“å‰èŠ‚ç‚¹çš„å€¼æ€»å’Œ
        self.sum = 0


class MapSum:
    def __init__(self):
        """
        Initialize your data structure here.
        """
        self.root = Node()
        # é¢å¤–kvå­—å…¸è®°å½•key:valueæ˜ å°„
        self.k2v = {}

    def insert(self, key: str, val: int) -> None:
        # diffå­˜å‚¨å½“å‰keyçš„è·¯å¾„ä¸Šå„ä¸ªèŠ‚ç‚¹éœ€è¦å¢åŠ çš„å€¼
        # å¦‚æœå½“å‰keyä¸åœ¨å­—å…¸ä¸­, åˆ™å„ä¸ªèŠ‚ç‚¹å¢åŠ çš„å€¼å°±æ˜¯val
        # å¦åˆ™å¢åŠ çš„å€¼æ˜¯æ–°å€¼å’Œæ—§å€¼çš„å·®
        diff = val if key not in self.k2v else val - self.k2v[key]
        self.k2v[key] = val
        cur = self.root
        for c in key:
            if c not in cur.children:
                cur.children[c] = Node()
            cur = cur.children[c]
            # å½“å‰èŠ‚ç‚¹çš„å€¼æ€»å’ŒåŠ ä¸Šdiff
            cur.sum += diff

    def sum(self, prefix: str) -> int:
        cur = self.root
        for c in prefix:
            if c not in cur.children:
                # å½“å‰å‰ç¼€ä¸å­˜åœ¨, è¿”å›0
                return 0
            cur = cur.children[c]
        # è¿”å›å½“å‰å‰ç¼€çš„å€¼æ€»å’Œ
        return cur.sum
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
