> 题目难度: 中等

> [原题链接](https://leetcode.cn/problems/jian-sheng-zi-lcof/)

> 今天继续更新 Leetcode 的剑指 Offer（专项突击版）系列, 大家在公众号 **算法精选** 里回复 `剑指offer2` 就能看到该系列当前连载的所有文章了, 记得关注哦~

## 题目描述

现需要将一根长为正整数 bamboo_len 的竹子砍为若干段，每段长度均为正整数。请返回每段竹子长度的最大乘积是多少。

### 示例 1：

- 输入: bamboo_len = 12
- 输出: 81

### 提示：

- 2 <= bamboo_len <= 58

## 题目思考

1. 怎样对题目进行抽象, 提取关键部分?
2. 如何避免重复计算?

## 解决方案

### 思路

#### 分析

- 先分析题目, 其实这个题目等价于**给定一个数, 将其分解成至少两个正数, 求分解后的数的最大乘积**
- 再观察数据规模, `N` 的范围很小, 所以只要不是指数或更高复杂度的算法(例如`O(2^N)`), 都完全没问题
- 注意到一个数的最大乘积是不变的, 所以我们完全可以求得最大乘积后将其保存下来, 用于之后的计算中, 从而避免重复计算, 这就是记忆化搜索的思想
- 考虑前面几个数, `M` 大于 `1`, 意味着 `N=2` 的时候必须拆分成`1*1`, `N=3` 的时候必须拆分为`1*2`, 这两个都是比原数字更小的, 而当 `N>=4` 的时候就可以至少拆分成两部分都大于等于 `2` 的数的乘积了, 这时候两者乘积就会大于等于两者之和
- 然后对于任意 `N>=4` 的数, 我们都可以将其拆分成`>=2`的一段, 而剩余部分当做一个整体求出其最大乘积 (这个最大乘积可能由两段或者更多段相乘得到, 这不是我们关心的重点), 这样就得到了一个拆分的方案; 然后求这些拆分方案中乘积最大的, 就是当前 `N` 的最大乘积, 将其记录下来以便之后的计算复用

#### 实现

- 注意 `N<=3` 的特殊情况, 乘积只能是`N-1`
- `N>=4` 时就要用上记忆化搜索
  - **递归出口**: `N<=3`, 直接返回 `N` 本身即可. 特别注意这里和上面`N<=3`并不同, 这里不需要再次拆分, 因为它是更大的数字拆分而来的, 所以自身就是最大值
  - **递归内部**: 此时`N>=4`, 正如上面分析, 先单独拿出一段, 并将剩余部分当做整体, 求两者乘积的最大值. 设单独的一段长度为 `i`, 那么 `i` 的取值是`[2,N-2]`, 因为如果切的一段为 `1` 的话, 其乘积一定比原来的值更小

### 复杂度

- 时间复杂度 `O(N^2)`
  - `N` 个数都要被递归调用一次, 然后递归内部有 `N` 的循环, 所以是`O(N^2)`
- 空间复杂度 `O(N)`
  - 记忆化搜索以及递归的栈的空间消耗(递归深度是 `N`)都是`O(N)`

### 代码

```python
class Solution:
    def cuttingBamboo(self, bamboo_len: int) -> int:
        if bamboo_len <= 3:
            # N<=3必须被拆分, 乘积比原数字恰好都小1
            return bamboo_len - 1

        @functools.cache
        def cut(bamboo_len):
            if bamboo_len <= 3:
                # 递归出口, 最大值就是原数字
                return bamboo_len
            # 先单独拿出一段, 并将剩余部分当做整体, 求两者乘积的最大值
            mx = 0
            for i in range(2, bamboo_len - 1):
                mx = max(mx, i * cut(bamboo_len - i))
            return mx

        return cut(bamboo_len)
```

---

> 大家可以在下面这些地方找到我~😊

> [我的 GitHub](https://github.com/zjulyx)

> [我的 Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [我的 CSDN](https://me.csdn.net/zjulyx1993)

> [我的知乎专栏](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [我的头条号](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [我的牛客网博客](https://blog.nowcoder.net/zjulyx)

> 我的公众号: [算法精选](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), 欢迎大家扫码关注~😊

![算法精选 - 微信扫一扫关注我](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
