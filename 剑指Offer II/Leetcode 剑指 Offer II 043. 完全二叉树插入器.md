> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode.cn/problems/NaqhDT/)

> ä»Šå¤©ç»§ç»­æ›´æ–° Leetcode çš„å‰‘æŒ‡ Offerï¼ˆä¸“é¡¹çªå‡»ç‰ˆï¼‰ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ `å‰‘æŒ‡offer2` å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

å®Œå…¨äºŒå‰æ ‘æ˜¯æ¯ä¸€å±‚ï¼ˆé™¤æœ€åä¸€å±‚å¤–ï¼‰éƒ½æ˜¯å®Œå…¨å¡«å……ï¼ˆå³ï¼ŒèŠ‚ç‚¹æ•°è¾¾åˆ°æœ€å¤§ï¼Œç¬¬ n å±‚æœ‰ 2n-1 ä¸ªèŠ‚ç‚¹ï¼‰çš„ï¼Œå¹¶ä¸”æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å°½å¯èƒ½åœ°é›†ä¸­åœ¨å·¦ä¾§ã€‚

è®¾è®¡ä¸€ä¸ªç”¨å®Œå…¨äºŒå‰æ ‘åˆå§‹åŒ–çš„æ•°æ®ç»“æ„ CBTInserterï¼Œå®ƒæ”¯æŒä»¥ä¸‹å‡ ç§æ“ä½œï¼š

- CBTInserter(TreeNode root) ä½¿ç”¨æ ¹èŠ‚ç‚¹ä¸º root çš„ç»™å®šæ ‘åˆå§‹åŒ–è¯¥æ•°æ®ç»“æ„ï¼›
- CBTInserter.insert(int v) å‘æ ‘ä¸­æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ç±»å‹ä¸º TreeNodeï¼Œå€¼ä¸º v ã€‚ä½¿æ ‘ä¿æŒå®Œå…¨äºŒå‰æ ‘çš„çŠ¶æ€ï¼Œå¹¶è¿”å›æ’å…¥çš„æ–°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å€¼ï¼›
- CBTInserter.get_root() å°†è¿”å›æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚

### ç¤ºä¾‹ 1ï¼š

- è¾“å…¥ï¼šinputs = `["CBTInserter","insert","get_root"]`, inputs = `[[[1]],[2],[]]`
- è¾“å‡ºï¼š`[null,1,[1,2]]`

### ç¤ºä¾‹ 2ï¼š

- è¾“å…¥ï¼šinputs = `["CBTInserter","insert","insert","get_root"]`, inputs = `[[[1,2,3,4,5,6]],[7],[8],[]]`
- è¾“å‡ºï¼š`[null,3,4,[1,2,3,4,5,6,7,8]]`

### æç¤ºï¼š

- æœ€åˆç»™å®šçš„æ ‘æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œä¸”åŒ…å« 1 åˆ° 1000 ä¸ªèŠ‚ç‚¹ã€‚
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æœ€å¤šè°ƒç”¨ CBTInserter.insert æ“ä½œ 10000 æ¬¡ã€‚
- ç»™å®šèŠ‚ç‚¹æˆ–æ’å…¥èŠ‚ç‚¹çš„æ¯ä¸ªå€¼éƒ½åœ¨ 0 åˆ° 5000 ä¹‹é—´ã€‚

## é¢˜ç›®æ€è€ƒ

1. å¦‚ä½•åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨?

## è§£å†³æ–¹æ¡ˆ

#### æ€è·¯

- åˆ†æé¢˜ç›®, ä¸ºäº†ä¿è¯æ’å…¥æ–°èŠ‚ç‚¹åä»ä¿æŒå®Œå…¨äºŒå‰æ ‘çš„çŠ¶æ€, æˆ‘ä»¬éœ€è¦çŸ¥é“å½“å‰å¾…æ’å…¥çš„èŠ‚ç‚¹ä½ç½®
- æ ¹æ®å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨, è¿™é‡Œæœ‰ä¸¤ç§å¯èƒ½:
  1. å½“å‰æœ€åº•å±‚è¿˜æœ‰ç©ºä½, åˆ™æ’å…¥ä½ç½®å°±æ˜¯ä¸Šä¸ªæ’å…¥èŠ‚ç‚¹çš„ç›¸é‚»å³ä¾§
  2. å½“å‰æœ€åº•å±‚æ²¡æœ‰ç©ºä½äº†, åˆ™éœ€è¦å¾€ä¸‹æ–°å¼€è¾Ÿä¸€å±‚, å¹¶æ’å…¥è¯¥å±‚æœ€å·¦ä¾§
- é‚£å¦‚ä½•åˆ¤æ–­å½“å‰æœ€åº•å±‚è¿˜æœ‰æ²¡æœ‰ç©ºä½å‘¢?
  - æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æŒ‰å±‚ BFS, è®°å½•æœ€åˆç»™å®šçš„æ ‘çš„æ¯ä¸€å±‚èŠ‚ç‚¹ä¿¡æ¯, è¿™æ ·å°±å¯ä»¥å¾—åˆ°æ ‘é«˜åº¦, ä»¥åŠæœ€åº•å±‚çš„èŠ‚ç‚¹ä¸ªæ•°
  - ç„¶åæ ¹æ®å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨, å¦‚æœæŸå±‚é«˜åº¦æ˜¯ h(ä» 0 å¼€å§‹), é‚£ä¹ˆå½“å…¶èŠ‚ç‚¹ä¸ªæ•°è¾¾åˆ° 2^h å°±è¡¨ç¤ºè¿™ä¸€å±‚æ»¡äº†, å¦åˆ™å°±è¿˜æœ‰ç©ºä½
  - æœ€åå†æŒ‰ç…§ä¸Šé¢çš„åˆ¤æ–­, å°±å¯ä»¥çŸ¥é“å½“å‰å¾…æ’å…¥èŠ‚ç‚¹ä½ç½®äº†
- æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¾—åˆ°å¾…æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹, è¿™é‡ŒåŒæ ·å¯ä»¥åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨: æŸä¸€å±‚ç¬¬ i ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸€å®šæ˜¯ä¸Šä¸€å±‚ç¬¬ i/2 ä¸ªèŠ‚ç‚¹ (i ä¸‹æ ‡ä» 0 å¼€å§‹)
- ä¸¾ä¸¤ä¸ªä¾‹å­:
  1. æŸä¸€å±‚ç¬¬ 0 ä¸ªèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ˜¯ä¸‹ä¸€å±‚ç¬¬ 0 ä¸ªèŠ‚ç‚¹, å³å­èŠ‚ç‚¹æ˜¯ä¸‹ä¸€å±‚ç¬¬ 1 ä¸ªèŠ‚ç‚¹
  2. æŸä¸€å±‚ç¬¬ 2 ä¸ªèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ˜¯ä¸‹ä¸€å±‚ç¬¬ 4 ä¸ªèŠ‚ç‚¹, å³å­èŠ‚ç‚¹æ˜¯ä¸‹ä¸€å±‚ç¬¬ 5 ä¸ªèŠ‚ç‚¹
- å¾—åˆ°çˆ¶èŠ‚ç‚¹ä¹‹å, æˆ‘ä»¬åˆ¤æ–­å…¶å·¦å­èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º, æ˜¯çš„è¯å°±è¯´æ˜å¾…æ’å…¥èŠ‚ç‚¹æ˜¯å…¶å·¦å­èŠ‚ç‚¹, å¦åˆ™å°±æ˜¯å…¶å³å­èŠ‚ç‚¹
- ä¸‹é¢çš„ä»£ç å°±å¯¹åº”äº†ä¸Šé¢çš„æ•´ä¸ªè¿‡ç¨‹, å¹¶ä¸”æœ‰è¯¦ç»†çš„æ³¨é‡Š, æ–¹ä¾¿å¤§å®¶ç†è§£

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(1): æ¯æ¬¡ insert åªéœ€è¦å‡ ä¸ªå¸¸æ•°æ—¶é—´çš„æ“ä½œ
- ç©ºé—´å¤æ‚åº¦ O(N): éœ€è¦å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹åˆ°å¯¹åº”çš„å±‚

#### ä»£ç 

```python
class CBTInserter:
    def __init__(self, root: TreeNode):
        self.root = root
        self.levels = []
        q = [root]
        while q:
            curlen = len(q)
            for node in q[:curlen]:
                if node.left:
                    q.append(node.left)
                if node.right:
                    q.append(node.right)
            # å°†å½“å‰å±‚åŠ å…¥levelsåˆ—è¡¨
            self.levels.append(q[:curlen])
            q = q[curlen:]

    def insert(self, v: int) -> int:
        h = len(self.levels) - 1
        if len(self.levels[-1]) == 1 << h:
            # æœ€åº•å±‚æ»¡äº†, éœ€è¦æ–°å»ºä¸€å±‚
            self.levels.append([])
        # çˆ¶èŠ‚ç‚¹ä¸‹æ ‡æ˜¯å½“å‰å¾…æ’å…¥ä¸‹æ ‡é™¤ä»¥2
        pi = len(self.levels[-1]) // 2
        # çˆ¶èŠ‚ç‚¹åœ¨å€’æ•°ç¬¬äºŒå±‚, æ ¹æ®å…¶ä¸‹æ ‡å¾—åˆ°çˆ¶èŠ‚ç‚¹
        parent = self.levels[-2][pi]
        # è¿½åŠ çˆ¶å­è¿æ¥
        node = TreeNode(v)
        if not parent.left:
            # çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹è¿˜ä¸å­˜åœ¨, å°†å…¶æŒ‡å®šä¸ºnode
            parent.left = node
        else:
            # çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å·²å­˜åœ¨, å°†å³å­èŠ‚ç‚¹æŒ‡å®šä¸ºnode
            parent.right = node
        # å°†nodeæ·»åŠ åˆ°æœ€åº•å±‚
        self.levels[-1].append(node)
        return parent.val

    def get_root(self) -> TreeNode:
        return self.root
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
