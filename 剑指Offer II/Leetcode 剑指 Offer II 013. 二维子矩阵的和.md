> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode.cn/problems/O4NDxx)

> ä»Šå¤©ç»§ç»­æ›´æ–° Leetcode çš„å‰‘æŒ‡ Offerï¼ˆä¸“é¡¹çªå‡»ç‰ˆï¼‰ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ `å‰‘æŒ‡offer2` å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ matrixï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š

è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„å·¦ä¸Šè§’ä¸º (row1,Â col1) ï¼Œå³ä¸‹è§’ä¸º (row2,Â col2) ã€‚
å®ç° NumMatrix ç±»ï¼š

NumMatrix(int[][] matrix)Â  ç»™å®šæ•´æ•°çŸ©é˜µ matrix è¿›è¡Œåˆå§‹åŒ–
int sumRegion(int row1, int col1, int row2, int col2)Â  è¿”å›å·¦ä¸Šè§’ (row1,Â col1)Â ã€å³ä¸‹è§’ Â (row2,Â col2)Â  çš„å­çŸ©é˜µçš„å…ƒç´ æ€»å’Œã€‚

### ç¤ºä¾‹ 1ï¼š

![](https://pic.leetcode-cn.com/1626332422-wUpUHT-image.png)

- è¾“å…¥:
  - ["NumMatrix","sumRegion","sumRegion","sumRegion"]
  - [[[[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]],[2,1,4,3],[1,1,2,2],[1,2,2,4]]
- è¾“å‡º:
  - [null, 8, 11, 12]
- è§£é‡Š:
  - NumMatrix numMatrix = new NumMatrix([[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]]);
  - numMatrix.sumRegion(2, 1, 4, 3); // return 8 (çº¢è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
  - numMatrix.sumRegion(1, 1, 2, 2); // return 11 (ç»¿è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
  - numMatrix.sumRegion(1, 2, 2, 4); // return 12 (è“è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)

### æç¤ºï¼š

- m == matrix.length
- n == matrix[i].length
- 1 <= m,Â n <=Â 200
- -10^5Â <= matrix[i][j] <= 10^5
- 0 <= row1 <= row2 < m
- 0 <= col1 <= col2 < n
- æœ€å¤šè°ƒç”¨ 10^4 æ¬¡ Â sumRegion æ–¹æ³•

## é¢˜ç›®æ€è€ƒ

1. å¦‚ä½•ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦?

## è§£å†³æ–¹æ¡ˆ

#### æ€è·¯

- åˆ†æé¢˜ç›®, æœ€å®¹æ˜“æƒ³åˆ°çš„åšæ³•å°±æ˜¯æš´åŠ›è®¡ç®—: æ¯æ¬¡ç´¯åŠ æ‰€éœ€å­çŸ©é˜µçš„æ‰€æœ‰å…ƒç´ 
- ä½†è¿™ç§åšæ³•æ—¶é—´æ•ˆç‡å¤ªä½ (`O(MNK)`, K æ˜¯ Â sumRegion çš„è°ƒç”¨æ¬¡æ•°), å¦‚ä½•ä¼˜åŒ–å‘¢?
- é‡æ–°åˆ†æé¢˜ç›®, è¿™ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯è·Ÿä¸€ç»´æ•°ç»„çš„å­æ•°ç»„å’Œå¾ˆç±»ä¼¼? è¿™é‡Œåªæ˜¯æŠŠä¸€ç»´çš„æ•°ç»„æ¢æˆäº†äºŒç»´çš„çŸ©é˜µè€Œå·²
- å®šä¹‰å‰ç¼€å’ŒäºŒç»´æ•°ç»„ sums, sums[r+1][c+1]å­˜å·¦ä¸Šè§’(0,0)åˆ°å³ä¸‹è§’(r,c)çš„çŸ©é˜µå’Œ
- è¿™é‡Œä¹‹æ‰€ä»¥ç”¨(r+1,c+1)è€Œä¸æ˜¯(r,c)ä½œä¸ºä¸‹æ ‡, æ˜¯ä¸ºäº†å¤„ç†ç©ºå­çŸ©é˜µçš„æƒ…å†µ, è¿™æ · sums ä¸ç®¡å“ªä¸€ç»´ä¸‹æ ‡æ˜¯ 0 æ—¶, éƒ½è¡¨ç¤ºç©ºçŸ©é˜µ, å¯¹åº”çš„å‰ç¼€å’Œå°±æ˜¯åˆå§‹å€¼ 0, æ— éœ€åŠ ä¸Šé¢å¤–çš„ if åˆ¤æ–­
- æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å‰ç¼€å’Œ, æ±‚å‡ºä»»æ„ä¸€ä¸ªå­çŸ©é˜µ[(sr,sc),(er,ec)]çš„å’Œ
- å¤§å®¶å¯ä»¥ç”»ä¸ªå›¾æ¥ç†è§£, å­çŸ©é˜µ[(sr,sc),(er,ec)]æ˜¯å­çŸ©é˜µ[(0,0),(er,ec)]çš„å³ä¸‹è§’çš„çŸ©é˜µ, æƒ³è¦æ±‚å‡ºå®ƒ, æˆ‘ä»¬åªéœ€è¦æ ¹æ®[(0,0),(er,ec)]çš„å’Œ, å‡å»ä¸ŠåŠéƒ¨åˆ†çš„çŸ©é˜µ[(0,0),(sr-1,ec)]å’Œ, å†å‡å»å·¦åŠéƒ¨åˆ†çš„çŸ©é˜µ[(0,0),(er,sc-1)]å’Œ, æœ€ååŠ ä¸Šå·¦ä¸Šè§’è¢«é‡å¤å‡äº†ä¸¤æ¬¡çš„çŸ©é˜µ[(0,0),(sr-1,sc-1)]å’Œå³å¯
- å…·ä½“å°±æ˜¯`sumRegion((sr,sc),(er,ec)) = sums[er+1][ec+1]-sums[sr][ec+1]-sums[er+1][sc]+sums[sr,sc]`
- è‡³äºå¦‚ä½•æ±‚å‰ç¼€å’ŒäºŒç»´æ•°ç»„ sums æœ¬èº«, ä¹Ÿå¯ä»¥åˆ©ç”¨åŒæ ·çš„æ€è·¯, åªæ˜¯éœ€è¦å‡å»è¢«é‡å¤åŠ äº†ä¸¤æ¬¡çš„å­çŸ©é˜µ[(0,0),(r-1,c-1)]: `sums[r+1][c+1] = matrix[r][c]+sums[r][c+1]+sums[r+1][c]-sums[r][c]`

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ `O(MN)`: éœ€è¦é¢å¤–çš„å‰ç¼€å’Œæ•°ç»„
- ç©ºé—´å¤æ‚åº¦ `O(MN+K)`: åˆå§‹åŒ–å‰ç¼€å’Œæ•°ç»„éœ€è¦ `O(MN)` æ—¶é—´, ä¹‹åæ¯æ¬¡è°ƒç”¨ Â sumRegion éƒ½åªéœ€è¦ `O(1)`, æ€»å…±è°ƒç”¨ K æ¬¡, æ‰€ä»¥æ˜¯ `O(K)`

#### ä»£ç 

```python
class NumMatrix:
    def __init__(self, matrix: List[List[int]]):
        rows, cols = len(matrix), len(matrix[0])
        # å‰ç¼€å’Œæ•°ç»„çš„è¡Œåˆ—æ•°å„è‡ªåŠ 1, è¿™æ ·ä¸‹æ ‡0å°±ä»£è¡¨ç©ºçŸ©é˜µçš„æƒ…å†µ, å¯¹åº”å‰ç¼€å’Œä¹Ÿæ˜¯åˆå§‹å€¼0
        self.sums = [[0] * (cols + 1) for _ in range(rows + 1)]
        for r in range(rows):
            for c in range(cols):
                # å½“å‰æ ¼å­å€¼+å·¦ä¾§å­çŸ©é˜µ+ä¸Šä¾§å­çŸ©é˜µ-å·¦ä¸Šä¾§å­çŸ©é˜µ
                self.sums[r + 1][c + 1] = matrix[r][c] + self.sums[r][c + 1] + self.sums[r + 1][c] - self.sums[r][c]

    def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
        # å³ä¸‹ä¾§å­çŸ©é˜µ-å·¦ä¾§å­çŸ©é˜µ-ä¸Šä¾§å­çŸ©é˜µ+å·¦ä¸Šä¾§å­çŸ©é˜µ
        return self.sums[row2 + 1][col2 + 1] - self.sums[row1][col2 + 1] - self.sums[row2 + 1][col1] + self.sums[row1][col1]
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
