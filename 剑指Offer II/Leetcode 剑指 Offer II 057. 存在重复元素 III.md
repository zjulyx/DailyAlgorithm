> é¢˜ç›®éš¾åº¦: ä¸­ç­‰

> [åŸé¢˜é“¾æ¥](https://leetcode.cn/problems/7WqeDu/)

> ä»Šå¤©ç»§ç»­æ›´æ–° Leetcode çš„å‰‘æŒ‡ Offerï¼ˆä¸“é¡¹çªå‡»ç‰ˆï¼‰ç³»åˆ—, å¤§å®¶åœ¨å…¬ä¼—å· **ç®—æ³•ç²¾é€‰** é‡Œå›å¤ `å‰‘æŒ‡offer2` å°±èƒ½çœ‹åˆ°è¯¥ç³»åˆ—å½“å‰è¿è½½çš„æ‰€æœ‰æ–‡ç« äº†, è®°å¾—å…³æ³¨å“¦~

## é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸¤ä¸ªæ•´æ•° k å’Œ t ã€‚è¯·ä½ åˆ¤æ–­æ˜¯å¦å­˜åœ¨ ä¸¤ä¸ªä¸åŒä¸‹æ ‡ i å’Œ jï¼Œä½¿å¾— abs(nums[i] - nums[j]) <= t ï¼ŒåŒæ—¶åˆæ»¡è¶³ abs(i - j) <= k ã€‚

å¦‚æœå­˜åœ¨åˆ™è¿”å› trueï¼Œä¸å­˜åœ¨è¿”å› falseã€‚

### ç¤ºä¾‹ 1ï¼š

- è¾“å…¥ï¼šnums = [1,2,3,1], k = 3, t = 0
- è¾“å‡ºï¼štrue

### ç¤ºä¾‹ 2ï¼š

- è¾“å…¥ï¼šnums = [1,0,1,1], k = 1, t = 2
- è¾“å‡ºï¼štrue

### ç¤ºä¾‹ 3ï¼š

- è¾“å…¥ï¼šnums = [1,5,9,1,5,9], k = 2, t = 3
- è¾“å‡ºï¼šfalse

### æç¤ºï¼š

- 0 <= nums.length <= 2 \* 10^4
- -2^31 <= nums[i] <= 2^31 - 1
- 0 <= k <= 10^4
- 0 <= t <= 2^31 - 1

## é¢˜ç›®æ€è€ƒ

1. å¦‚ä½•ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦?

## è§£å†³æ–¹æ¡ˆ

#### æ€è·¯

- åˆ†æé¢˜ç›®, ä¸€ä¸ªå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ€è·¯å°±æ˜¯æš´åŠ›ä¸¤é‡å¾ªç¯, å¤–å±‚éå†æ¯ä¸ªæ•°å­—ä½œä¸ºèµ·ç‚¹, å†…å±‚ä»è¯¥èµ·ç‚¹å‘åéå† k ä¸ªæ•°å­—, åˆ¤æ–­æ˜¯å¦å­˜åœ¨å·®å€¼ä¸è¶…è¿‡ t çš„æ•°å­—å¯¹
- ä¸è¿‡è¿™ç§åšæ³•çš„æ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº† O(NK), å¾ˆå®¹æ˜“è¶…æ—¶, å¦‚ä½•ä¼˜åŒ–å‘¢?
- ä¸Šé¢çš„æš´åŠ›æ³•æ˜¯é€šè¿‡ä¸¤é‡å¾ªç¯çš„æ–¹å¼ä¿è¯ä¸‹æ ‡å·®æœ‰æ•ˆ, ç„¶åå†åˆ¤æ–­å·®å€¼, æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯, å…ˆä¿è¯å·®å€¼æœ‰æ•ˆ, ç„¶åå†åˆ¤æ–­ä¸‹æ ‡å·®
- ç”±äºé¢˜ç›®è¦æ±‚å·®å€¼ä¸è¶…è¿‡ t, å¦‚æœæˆ‘ä»¬å°†æ•°å­—æ˜ å°„åˆ°ä¸€ä¸ªä¸ªæ¡¶ä¸­, ç„¶åæ¯ä¸ªæ¡¶çš„å¤§å°æ˜¯ t+1, æ•°å­— x å¯¹åº”çš„æ¡¶ id å°±æ˜¯ `x/(t+1)`, è¿™æ ·å°±åªéœ€è¦éå†ç›¸é‚»çš„ä¸‰ä¸ªæ¡¶å³å¯
  - ä¸¾ä¸ªä¾‹å­: å¯¹äºæŸä¸ªæ•°å­— x, å‡è®¾å…¶å¯¹åº”çš„æ¡¶ id æ˜¯ j, é‚£ä¹ˆåªéœ€è¦åˆ¤æ–­ç›¸é‚»çš„ä¸‰ä¸ªæ¡¶(j-1,j,j+1)å³å¯, å› ä¸ºå…¶ä»–æ¡¶çš„æ•°å­—ä¸ x çš„å·®å€¼ä¸€å®šè¶…è¿‡ t (ä¸­é—´è‡³å°‘é—´éš”äº†ä¸€ä¸ªæ¡¶, å³ t+1)
- ç„¶åæ¯ä¸ªæ¡¶å­˜å‚¨æœ€æ–°æ˜ å°„åˆ°è¯¥æ¡¶çš„æ•°å­—çš„ä¸‹æ ‡, è¿™æ ·å°±å¾ˆå®¹æ˜“åˆ¤æ–­ä¸‹æ ‡å·®æ˜¯å¦è¶…è¿‡ k äº†
- æœ€åæˆ‘ä»¬è¿˜å¾—å†æ¬¡ç¡®è®¤å¯¹åº”æ•°å­—å¯¹çš„å·®å€¼æ˜¯å¦çœŸçš„ä¸è¶…è¿‡ t, å› ä¸ºç›¸é‚»æ¡¶çš„ä¸¤ä¸ªæ•°å­—å·®å€¼å¯èƒ½ä¼šè¶…è¿‡ t, ä¾‹å¦‚æ•°å­—å¯¹`(x, x+t+1)`
- å¦å¤–æ³¨æ„, æˆ‘ä»¬åœ¨éå†æŸä¸ªä¸‹æ ‡ i æ—¶, æ€»æ˜¯å¯ä»¥å°†å¯¹åº”æ¡¶çš„å€¼æ›´æ–°ä¸ºå®ƒ, å› ä¸ºå³ä½¿ä¹‹å‰å­˜åœ¨å¦ä¸€ä¸ªä¸‹æ ‡ pi ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªæ¡¶, é‚£ä¹ˆå½“éå†åé¢çš„æŸä¸ªä¸‹æ ‡ j æ—¶ (å³`pi<i<j`), åªå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µ:
  1. pi å’Œ j çš„ä¸‹æ ‡å·®ä¸è¶…è¿‡ k: æ­¤æ—¶ pi å’Œ i çš„ä¸‹æ ‡å·®æ›´ä¸ä¼šè¶…è¿‡ k, æ‰€ä»¥ pi å’Œ i æœ¬èº«å°±æ„æˆäº†æœ‰æ•ˆçš„æ•°å­—å¯¹ (åœ¨åŒä¸€ä¸ªæ¡¶å†…, å·®å€¼æ€»æ˜¯ä¸è¶…è¿‡ t), éå† i æ—¶å°±å¯ä»¥ç›´æ¥è¿”å› true
  2. pi å’Œ j çš„ä¸‹æ ‡å·®è¶…è¿‡ k: pi å’Œ j ä¸èƒ½æ„æˆæœ‰æ•ˆçš„æ•°å­—å¯¹
- ç»¼åˆä¸¤ç§æƒ…å†µ, pi ä¸ä¼šå†è¢«ç”¨åˆ°, æ‰€ä»¥æ€»æ˜¯å¯ä»¥å°†æ¡¶çš„å€¼æ›´æ–°ä¸ºæœ€æ–°çš„ä¸‹æ ‡ i
- ä¸‹é¢ä»£ç ä¸­æœ‰è¯¦ç»†çš„æ³¨é‡Š, æ–¹ä¾¿å¤§å®¶ç†è§£

#### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ O(N): åªéœ€è¦éå†æ¯ä¸ªæ•°å­—ä¸€é
- ç©ºé—´å¤æ‚åº¦ O(N): é¢å¤–æ¡¶æ˜ å°„å­—å…¸, æœ€å·®æƒ…å†µæ¯ä¸ªæ•°å­—å¯¹åº”ç‹¬ç«‹çš„ä¸€ä¸ªæ¡¶

#### ä»£ç 

```python
class Solution:
    def containsNearbyAlmostDuplicate(self, nums: List[int], k: int, t: int) -> bool:
        # å°†æ•°å­—ç¦»æ•£åŒ–æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸­, æ¯ä¸ªæ¡¶çš„å¤§å°æ˜¯t+1, æ•°å­—xå¯¹åº”çš„æ¡¶idå°±æ˜¯x/(t+1)
        # è¿™æ ·å¯¹äºæŸä¸ªæ•°å­—x, å‡è®¾å…¶å¯¹åº”çš„æ¡¶idæ˜¯j, é‚£ä¹ˆåªéœ€è¦åˆ¤æ–­(j-1,j,j+1)ä¸‰ä¸ªæ¡¶å³å¯, å› ä¸ºå…¶ä»–æ¡¶çš„æ•°å­—ä¸xçš„å·®å€¼ä¸€å®šè¶…è¿‡t
        buckets = {}
        for i, x in enumerate(nums):
            # æ±‚å‡ºå¯¹åº”æ¡¶id
            id = x // (t + 1)
            for nid in (id - 1, id, id + 1):
                # éå†ç›¸é‚»ä¸‰ä¸ªæ¡¶
                if nid in buckets and i - buckets[nid] <= k and abs(x - nums[buckets[nid]]) <= t:
                    # å¦‚æœå­˜åœ¨ä¸‹æ ‡å·®ä¸è¶…è¿‡k, ä¸”å·®å€¼ä¸è¶…è¿‡tçš„æ•°å­—å¯¹, åˆ™æœ‰æ•ˆ
                    # æ³¨æ„è¿™é‡Œä¸èƒ½çœç•¥å·®å€¼åˆ¤æ–­, å› ä¸ºç›¸é‚»æ¡¶çš„ä¸¤ä¸ªæ•°å­—å·®å€¼å¯èƒ½ä¼šè¶…è¿‡t, ä¾‹å¦‚æ•°å­—å¯¹(x, x+t+1)
                    return True
            # åœ¨éå†æŸä¸ªä¸‹æ ‡ i æ—¶, æ€»æ˜¯å¯ä»¥å°†å¯¹åº”æ¡¶çš„å€¼æ›´æ–°ä¸ºå®ƒ, å› ä¸ºå³ä½¿ä¹‹å‰å­˜åœ¨å¦ä¸€ä¸ªä¸‹æ ‡ pi ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªæ¡¶, é‚£ä¹ˆå½“éå†åé¢çš„æŸä¸ªä¸‹æ ‡ j æ—¶ (å³`pi<i<j`), åªå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µ:
            # 1. piå’Œjçš„ä¸‹æ ‡å·®ä¸è¶…è¿‡k: æ­¤æ—¶piå’Œiçš„ä¸‹æ ‡å·®æ›´ä¸ä¼šè¶…è¿‡k, æ‰€ä»¥piå’Œiæœ¬èº«å°±æ„æˆäº†æœ‰æ•ˆçš„æ•°å­—å¯¹ (åœ¨åŒä¸€ä¸ªæ¡¶å†…, å·®å€¼æ€»æ˜¯ä¸è¶…è¿‡t), éå†iæ—¶å°±å¯ä»¥ç›´æ¥è¿”å›true
            # 2. piå’Œjçš„ä¸‹æ ‡å·®è¶…è¿‡k: piå’Œjä¸èƒ½æ„æˆæœ‰æ•ˆçš„æ•°å­—å¯¹
            # ç»¼åˆä¸¤ç§æƒ…å†µ, piä¸ä¼šå†è¢«ç”¨åˆ°, æ‰€ä»¥æ€»æ˜¯å¯ä»¥å°†æ¡¶çš„å€¼æ›´æ–°ä¸ºæœ€æ–°çš„ä¸‹æ ‡i
            buckets[id] = i
        return False
```

---

> å¤§å®¶å¯ä»¥åœ¨ä¸‹é¢è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘~ğŸ˜Š

> [æˆ‘çš„ GitHub](https://github.com/zjulyx)

> [æˆ‘çš„ Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [æˆ‘çš„ CSDN](https://me.csdn.net/zjulyx1993)

> [æˆ‘çš„çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [æˆ‘çš„å¤´æ¡å·](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [æˆ‘çš„ç‰›å®¢ç½‘åšå®¢](https://blog.nowcoder.net/zjulyx)

> æˆ‘çš„å…¬ä¼—å·: [ç®—æ³•ç²¾é€‰](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), æ¬¢è¿å¤§å®¶æ‰«ç å…³æ³¨~ğŸ˜Š

![ç®—æ³•ç²¾é€‰ - å¾®ä¿¡æ‰«ä¸€æ‰«å…³æ³¨æˆ‘](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
