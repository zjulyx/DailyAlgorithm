> 题目难度: 简单

> [原题链接](https://leetcode.cn/problems/w3tCBm/)

> 今天继续更新 Leetcode 的剑指 Offer（专项突击版）系列, 大家在公众号 **算法精选** 里回复 `剑指offer2` 就能看到该系列当前连载的所有文章了, 记得关注哦~

## 题目描述

给定一个非负整数 n ，请计算 0 到 n 之间的每个数字的二进制表示中 1 的个数，并输出一个数组。

### 示例 1:

- 输入: n = 2
- 输出: [0,1,1]
- 解释:

```
0 --> 0
1 --> 1
2 --> 10
```

### 示例  2:

- 输入: n = 5
- 输出: [0,1,1,2,1,2]
- 解释:

```
0 --> 0
1 --> 1
2 --> 10
3 --> 11
4 --> 100
5 --> 101
```

### 说明 :

0 <= n <= 10^5

### 进阶:

- 给出时间复杂度为  O(n\*sizeof(integer))  的解答非常容易。但你可以在线性时间  O(n)  内用一趟扫描做到吗？
- 要求算法的空间复杂度为  O(n) 。
- 你能进一步完善解法吗？要求在 C++或任何其他语言中不使用任何内置函数（如 C++ 中的  \_\_builtin_popcount ）来执行此操作。

## 题目思考

1. 如何做到线性时间一趟扫描?
2. 前后数字之间是否有关联?

## 解决方案

### 思路

- 分析题目, 一个很容易想到的方法就是从 0 遍历到 N, 然后依次统计每个数字的二进制 1 的数目 (不断右移并检查最低位数字, 是 1 则累加计数)
- 但这种算法的时间复杂度是 O(n\*sizeof(integer)), 如何达到题目里的进阶要求 (线性时间一趟扫描) 呢?
- 如果在计算后面数字的 1 的个数时, 能利用之前数字的计算结果, 这样我们就无需诸位统计了
- 例如对于二进制数 0b1011 来说, 它有 3 个 1, 相比 0b1010 多了最低位的 1
- 这样就可以将问题转换成求将最低位 1 翻转成 0 的数字了, 那如何求解呢?
- 如果当前数字 n 的个位是 1, 显然 n-1 就可以将最低位翻转成 0 了, 那对于个位不是 1 的数字呢?
- 此时 n 的最低位 1 后面一定全是 0, 所以 n 长这样: 0bxxx1000, n-1 的话就是 0bxxx0111
- 那么将 n-1 与 n 求与, 得到的结果就是 0bxxx0000, 正是将 n 的最低位 1 翻转成 0 的数字
- 综合上述两种情况, n&(n-1) 即可得到 1 的数目比 n 少 1 的数字 (因为即使个位是 1, n&(n-1)还是 n-1)
- 所以 n 的 1 的数目就是 n&(n-1)的 1 的数目加 1
- 我们依次从 1 开始遍历到 n, 利用上述规则即可在线性时间内一趟扫描求出所有数字的 1 的数目

### 复杂度

- 时间复杂度 O(N): 线性时间, 一趟扫描
- 空间复杂度 O(N): 最终结果数组需要存 N 个数字

### 代码

```python
class Solution:
    def countBits(self, n: int) -> List[int]:
        res = [0] * (n + 1)
        for mask in range(1, n + 1):
            # pre是mask将最低位1变成0后的数字
            pre = mask & (mask - 1)
            # mask相比pre多了一个1
            res[mask] = res[pre] + 1
        return res
```

---

> 大家可以在下面这些地方找到我~😊

> [我的 GitHub](https://github.com/zjulyx)

> [我的 Leetcode](https://leetcode-cn.com/u/suibianfahui/)

> [我的 CSDN](https://me.csdn.net/zjulyx1993)

> [我的知乎专栏](https://zhuanlan.zhihu.com/c_1242508721932464128)

> [我的头条号](https://www.toutiao.com/c/user/1090304683804520/#mid=1671643017345028)

> [我的牛客网博客](https://blog.nowcoder.net/zjulyx)

> 我的公众号: [算法精选](https://mp.weixin.qq.com/s?__biz=MzA5MDk1MjI5MA==&mid=2247484158&idx=1&sn=90176bac32cf7af40e4074c721fd8a95&chksm=900285f3a7750ce5a068c9c9773781461819633f2fd60533732637ec9520c908371ebc218d49&scene=178&cur_album_id=1386231241346859009#rd), 欢迎大家扫码关注~😊

![算法精选 - 微信扫一扫关注我](https://pic1.zhimg.com/80/v2-7c988a7b35886df51596ef23616764ac_1440w.jpg)
